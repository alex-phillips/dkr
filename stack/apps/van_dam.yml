version: "3"
services:
  vandam:
    container_name: vandam
    image: ghcr.io/floppy/van_dam:latest
    networks:
      - data
      - external
    environment:
      DATABASE_URL: postgresql://van_dam:${DB_PASS_VAN_DAM}@postgres/van_dam?pool=5
      SECRET_KEY_BASE: ${VAN_DAM_SECRET_KEY_BASE}
      REDIS_URL: redis://redis:6379/1
      # RAILS_RELATIVE_URL_ROOT: /vandam Sets the root of the app to /vandam useful for reverse proxies with nginx
    volumes:
      - ${NAS}/docker/van_dam:/libraries
    depends_on:
      - postgres
      - redis
    labels:
      ingress:
        - port: 3214
          host: stl.${SERVER_DOMAIN}
