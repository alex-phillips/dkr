version: '2'
services:
  mariadb:
    container_name: mariadb
    image: ghcr.io/linuxserver/mariadb:10.6.11
    networks:
      - data
    volumes:
      - ${NAS}/docker/mariadb:/config
    ports:
      - 3306:3306
    environment:
      PGID: ${PGID}
      PUID: ${PUID}
      TZ: ${TIMEZONE}
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
    healthcheck:
      test: "mysql -uroot -p$MYSQL_ROOT_PASSWORD mysql -e 'select 1'"
      timeout: 20s
      retries: 10
    labels:
      namespace: data

  phpmyadmin:
    container_name: phpmyadmin
    image: phpmyadmin/phpmyadmin
    networks:
      - data
    environment:
      - PMA_ARBITRARY=1
    depends_on:
      - mariadb
    labels:
      port: 80
      host: db.${SERVER_DOMAIN}
      auth: true
